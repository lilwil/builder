{neq name='field.type' value='hidden'}


<div class="layui-form-item" id="trigger_{$field['jquery_id']}">


<label class="layui-form-label">{$field.title|htmlspecialchars}：</label>

<div class="layui-input-inline">
        {switch name="field.type"}
        {case value="string"}
    <input type="text" name="{$field.name}" value="{$field.value|htmlspecialchars}" class="layui-input"  />
        {/case}
        {case value="headline"}
        <input type="text"  size="{$field['size']}" name="{$field.name}" value="{$field.value|htmlspecialchars}" style="color:{$field['options']['color']}">
        &nbsp;显示颜色： <input type="text" name="color" id="yicmf_builder_color" value="{$field['options']['color']}" style="background-color:{$field['options']['color']} " data-toggle="colorpicker" data-bgcolor="true" size="9" readonly>
        <a href="javascript:;" title="清除" data-toggle="clearcolor" data-target="#yicmf_builder_color">清除</a>
        {/case}
        {case value="color"}
        <input type="text" name="{$field.name}" id="yicmf_builder_color_{$field.name}" value="{$field.value}" style="color:{$field.value}" data-toggle="colorpicker" data-bgcolor="true" size="9" readonly>
        <a href="javascript:;" title="清除" data-toggle="clearcolor" data-target="#yicmf_builder_color_{$field.name}">清除</a>
        {/case}
        {case value="html"}
        {$field['options']}
        {/case}
        {case value="label"}
        {$field.value}
        {/case}
        {case value="password"}
        <input type="password"   name="{$field.name}" autocomplete="off" class="layui-input" value="{$field.value|htmlspecialchars}" >
        {/case}
        {case value="readonly"}
        <input type="text"  size="{$field['size']}" value="{$field.value|htmlspecialchars}" placeholder="无需填写" readonly>
        {/case}
        {case value="amap"}
        <span id="{$field.name}_info">{$field['value']['name']|default="暂无选择"}</span>

        <input type="hidden" id="{$field.name}" name="{$field.name}" value="{$field['value']|json_encode}">
        <button type="button" class="btn-default"
                data-toggle="dialog" data-options="{id:'amap_{$field.name}_dialog', url:'{:addon_url('Amap://Amap/index')}', title:'地图选点',max:true,width:1100,height:800,mask:true}">地图选点</button>
        <script type="text/javascript">

            function amapOk(obj)
            {
                var flag = true;
                var info = JSON.parse($('#amap_result').val());
                console.log(info);
                $("#{$field.name}").val($('#amap_result').val());
                $("#{$field.name}_info").html(info.name);
                if(flag){
                    $(this).dialog('close','amap_{$field.name}_dialog');
                }else{
                    $(this).alertmsg('error','您未选择需要操作的图片');
                }
            }
            function amapNo()
            {
                $("#{$field.name}").val(JSON.stringify({}));
                $("#{$field.name}_info").html('暂无选择');
            }
        </script>
        {/case}

        {case value="textarea"}
        <textarea name="{$field.name}" class="layui-textarea" cols="{$field['size'][0]}" rows="{$field['size'][1]}" {$field['rule']|raw} >{$field.value|htmlspecialchars}</textarea>
        {/case}
        {case value="default"}
        <input type="text" class="layui-input"  size="{$field['size']}" name="{$field.name}" {$field['rule']|raw} value="{$field['value']}" >
        {/case}
        {case value="number"}
        <input type="number"   name="{$field.name}"  class="layui-input"  {$field['rule']|raw} value="{$field['value']}">
        {/case}
        {case value="url"}
        <input type="text" name="{$field.name}" size="{$field['size']}" value="{$field.value|htmlspecialchars}" data-rule="url">
        {/case}
        {case value="belongTo"}<!-- 属于选择 -->

        <input type="hidden" name="{$field['name']}" value="{$field['value']}" id="key_{$field['name']}">
        <input type="text"  name="{$field.name}_{$field['options']['field']}" readonly  value="{$field['value']}"   id="{$field.name}_{$field['options']['field']}"
               {$field['rule']|raw} size="{$field['size']}"
        data-width = '{$field['size']}' >&nbsp;<p class="fa fa-search" onclick='find_dialog_{$field['name']}(this)'>
        </p>
        <a href="javascript:;" title="清空选择"  onclick="clearFind(this)">清空选择</a>
        <script type="text/javascript">
            function clearFind(obj) {
                $(obj).prev().prev().val('');
                $(obj).prev().prev().prev().val('');
            }
            function find_dialog_{$field['name']}(obj) {
                $(obj).dialog(
                    {id:"build_{$field['jquery_id']}",
                        data:{
                            field:"{$field['options']['field']}",
                            value:"{$field['value']}",
                            callback:"find_set_{$field['name']}",
                            limit:"{$field['options']['limit']}"
                        },
                        //   onClose:'tests',
                        url:"{$field['options']['url']}",
                        title:"选择{$field['title']}",
                        mask:'true',width:1200,height:700
                    });
            }
            /*   function tests(ev) {
                   console.log(this);
               }*/
            function find_set_{$field['name']}(id,field) {
                // 赋值
                $("#key_{$field['name']}").val(id);
                $("#{$field.name}_{$field['options']['field']}").val(field);
                $(this).dialog('close',"build_{$field['jquery_id']}");
            }
        </script>
        {/case}

        {case value="belongsToMany"}<!-- 多对多选择 -->
        {php}
        $value = '';
        if(!empty($field['value']) && count($field['value'])>0)
        {
        $temp_arr = [];
        foreach($field['value'] as $item)
        {
        $temp_arr[] = $item[$field['options']['field']];
        }
        $value = implode(',',$temp_arr);
        }

        {/php}
        <input type="hidden" name="{$field['name']}" value="{$value}" id="key_{$field['name']}">
        <input type="text"  name="{$field.name}_{$field['options']['field']}" readonly  value="{$value}"   id="{$field.name}_{$field['options']['field']}"
               {$field['rule']|raw} size="{$field['size']}"
        data-width = '{$field['size']}' >&nbsp;<p class="fa fa-search" onclick='find_dialog_{$field['name']}(this)'>
        </p>
        <a href="javascript:;" title="清空选择"  onclick="clearFind(this)">清空选择</a>
        <script type="text/javascript">
            function clearFind(obj) {
                $(obj).prev().prev().val('');
                $(obj).prev().prev().prev().val('');
            }
            function find_dialog_{$field['name']}(obj) {
                $(obj).dialog(
                    {id:"build_{$field['jquery_id']}",
                        data:{
                            field:"{$field['options']['field']}",
                            value:"{$value}",
                            callback:"find_set_{$field['name']}",
                            limit:"{$field['options']['limit']}"
                        },
                        //   onClose:'tests',
                        url:"{$field['options']['url']}",
                        title:"选择{$field['title']}",
                        mask:'true',width:1200,height:700
                    });
            }
            /*   function tests(ev) {
                   console.log(this);
               }*/
            function find_set_{$field['name']}(id,field) {
                // 赋值
                if ($("#key_{$field['name']}").val())
                {
                    var temp  = $("#key_{$field['name']}").val();
                    temp = temp.split(',');
                    temp.push(id);
                    $("#key_{$field['name']}").val(temp.join(','));
                    var temp  = $("#{$field.name}_{$field['options']['field']}").val();
                    temp = temp.split(',');
                    temp.push(field);
                    $("#{$field.name}_{$field['options']['field']}").val(temp.join(','));
                }else{
                    $("#key_{$field['name']}").val(id);
                    $("#{$field.name}_{$field['options']['field']}").val(field);
                }

                $(this).dialog('close',"build_{$field['jquery_id']}");
            }
        </script>
        {/case}


        {case value="select"}
        <!-- 单选菜单 -->
        <select name="{$field.name}" id="key_{$field.name}" {$field['rule']|raw}  data-width = '{$field['size']}' data-toggle="selectpicker" >
        {volist name="field.options" id="option"}
        {php}  $selected = $field['value']==$key ? 'selected' : '';{/php}
        <option  value="{$key}"{$selected}>{$option}</option>
        {/volist}
        </select>

        <!-- 单选菜单end -->

        {/case}
        {case value="select_multiple"}
        <!-- 多选菜单 -->
        <select data-toggle="selectpicker" {$field['rule']|raw} data-width = '{$field['size']?:'80%'}' name="{$field.name}[]" multiple>
        {volist name="field.options" id="option"}
        {php}
        if(!is_array($field['value'])){
        $field['value_array'] = explode(',', $field['value']);
        }else{
        $field['value_array'] =$field['value'];
        }
        $checked = in_array($key,$field['value_array']) ? ' selected="true"' : '';
        $inputId = "id_$field[name]_$key";
        {/php}
        <option   {$checked} id="{$inputId}"  value="{$key}"  >{$option|htmlspecialchars}</option>

        {/volist}
        </select>
        <!-- 多选菜单end -->

        {/case}

        {case value="checkbox"}
        {php}
        $importCheckBox = true;
        {/php}
        {php}
        if(!is_array($field['value']) && !empty($field['value'])){
        $field['value_array'] = explode(',', $field['value']);
        }elseif(empty($field['value'])){
        $field['value_array'] = [];
        }else{
        $field['value_array'] = $field['value'];
        }
        {/php}
        {volist name="field.options" id="option"}
        {php}
        $checked = in_array($key,$field['value_array']) ? 'checked' : '';
        $inputId = "id_$field[name]_$key";
        {/php}
        <input type="checkbox" name="{$field.name}[]" id="{$inputId}" value="{$key}"  {$checked} data-toggle="icheck" data-label="{$option}">
        {/volist}

        {/case}

        {case value="position"}
        {php}
        //dump($field);
        {/php}<div id='key_show_{$field['name']}'></div>
        <script type="text/javascript">

            function getOptions({$field['name']},{$field['options']['field']})
            {
                $.ajax({
                    type:"POST",
                    url:"{:\\think\\facade\\Url::build($field['options']['ajax_url'])}",
                    data:"{$field['options']['field']}="+{$field['options']['field']}+"&{$field['name']}="+{$field['name']}+"&id="+$("#key_id").val(),
                    //返回数据的格式
                    datatype: "json",
                    //成功返回之后调用的函数
                    success:function(data){
                        // TODO:需要调整
                        $('#key_show_{$field['name']}').html(data);
                    },
                    //调用出错执行的函数
                    error: function(){
                        //请求出错处理
                        $(this).alertmsg('error', '请求异常');
                    }
                });
            }

            getOptions({$field['value']?:0},$("#key_{$field['options']['field']}").val());

            $("#key_{$field['options']['field']}").change(function(){
                getOptions({$field['value']?:0},$("#key_{$field['options']['field']}").val());
            });

        </script>
        {/case}

        {case value="checkbox_link_check"}
        {php}
        //dump($field);
        {/php}<div id='key_show_{$field['name']}'></div>
        <script type="text/javascript">

            function getOptions({$field['name']},{$field['options']['field']})
            {
                $.ajax({
                    type:"POST",
                    url:"{:\\think\\facade\\Url::build($field['options']['ajax_url'])}",
                    data:"{$field['options']['field']}="+{$field['options']['field']}+"&{$field['name']}="+{$field['name']},
                    //返回数据的格式
                    datatype: "json",
                    //成功返回之后调用的函数
                    success:function(data){
                        // TODO:需要调整
                        $('#key_show_{$field['name']}').html(data);
                    },
                    //调用出错执行的函数
                    error: function(){
                        //请求出错处理
                        $(this).alertmsg('error', '请求异常');
                    }
                });
            }

            getOptions({$field['value']?:0},$("#key_{$field['options']['field']}").val());

            $("#key_{$field['options']['field']}").change(function(){
                getOptions({$field['value']?:0},$("#key_{$field['options']['field']}").val());
            });

        </script>
        {/case}

        {case value="editor"}

        <textarea name="{$field.name}"  data-boolean='true'
                  data-file-manager-json= "{$field.config.manager}"
                  data-upload-json="{$field.config.upload}"
                  data-toggle="kindeditor" data-items="{$field.config.items}">
			  {$field.value}</textarea>
        {/case}
        {case value="datetime"}
        <input type="text" name="{$field.name}" size="{$field['size']}" id="j_builder_{$field.name}" value="{$field.value}" data-toggle="datepicker" {$field['rule']|raw} placeholder="请点击选择日期">
        {/case}
        {case value="date"}
        <input type="text" name="{$field.name}" size="{$field['size']}" id="j_builder_{$field.name}" value="{$field.value}" data-toggle="datepicker" {$field['rule']|raw} placeholder="请点击选择日期">
        {/case}
        {case value="timerange"}
        <input type="text"  id="id_{$field['name'][0]}_start" size="{$field['size']}"  {$field['rule']|raw}
        name="{$field['name'][0]}"  value="{$field['value'][0]}" data-toggle="datepicker"  >
        - <input type="text" id="id_{$field['name'][1]}_end" size="{$field['size']}"  {$field['rule']|raw}
        name="{$field['name'][1]}"  value="{$field['value'][1]}"  data-toggle="datepicker"  >
        <script>
            var id_{$field['name'][0]}_start=0;
            $('#id_{$field['name'][0]}_start').on('afterchange.bjui.datepicker', function(e, data) {
                //赋值开始时间
                id_{$field['name'][0]}_start = data.value;
                $('#id_{$field['name'][1]}_end').datepicker();
                // do something...
            })
            $('#id_{$field['name'][1]}_end').on('afterchange.bjui.datepicker', function(e, data) {
                //判断是否和开始时间相同，如果相同则继续弹出选择对话框
                if(id_{$field['name'][0]}_start== data.value){
                    $(this).alertmsg('info','时间区间选择相同，请重新选择！');
                    $('#id_{$field['name'][1]}_end').datepicker();
                }
                // 开始时间要少于结束时间
                var startTime = id_{$field['name'][0]}_start;
                var start = new Date(startTime.replace("-", "/").replace("-", "/"));
                var endTime = data.value;
                var end = new Date(endTime.replace("-", "/").replace("-", "/"));
                if(end<start){
                    $(this).alertmsg('info','开始时间要少于结束时间，请重新选择！');
                    $('#id_{$field['name'][1]}_end').datepicker();
                }
                // do something...
            })
        </script>
        {/case}
        <!--添加城市选择（需安装城市联动插件）-->
        {case value="city"}
        {php}
        $city_param = ['value'=>$field['value'],'admin'=>'1','name'=>$field['name']];{/php}
        {Yicmf:hook name='china_city' param="$city_param"}
        {/case}
        {case value="sourse"}
        <input type="text" name="{$field.name}_input" size="{$field['size']}" value="" placeholder='来源站点名|http://www.baidu.com'>
        <select name="{$field.name}" id="{$field.name}" data-toggle="selectpicker" >
            <option  value="0">选择已有站点</option>
            {volist name="field.options" id="option"}
            {php}  $selected = $field['value']==$key ? 'selected' : '';{/php}
            <option  value="{$key}"{$selected}>{$option}</option>
            {/volist}
        </select>
        {/case}
        {case value="radio"}
        {php}
        foreach ($field['options'] as $key => $option) {
        $checked = $field['value']==$key ? 'checked' : '';
        $inputId = "id_$field[name]_$key";
        {/php}

        <input type="radio" name="{$field.name}" id="{$inputId}"  value="{$key}"  {$checked}  title="{$option|htmlspecialchars}">
        {php}
       }
        {/php}
        {/case}
        {case value='dragsort_li'}
        <script src="__COMMON__/dragsort/jquery.dragsort-0.5.2.min.js"></script>
        <input type="hidden" name="{$field.name}" value="{$field['value']}" >
        {empty name="field.value"}
        空
        {else /}<br>
        <ul id="sortUl" class="dragsort">
            {volist name=":explode(',',$field['value'])" id="addons_vo"}
            <li>{$key+1}--<span>{$addons_vo}</span></li><br>
            {/volist}
        </ul>
        <script type="text/javascript">
            $(function(){
                $("#sortUl").dragsort({
                    dragSelector:'li',
                    placeHolderTemplate: '<li class="draging-place">&nbsp;</li>',
                    dragEnd:function(){
                        updateVal();
                    }
                });

                $('#sortUl li b').click(function(){
                    $(this).parent().remove();
                    updateVal();
                });
                // 更新排序后的隐藏域的值
                function updateVal() {
                    var sortVal = [];
                    $('#sortUl li').each(function(){
                        alert($('em',this).text());
                        sortVal.push($('em',this).text());
                    });
                    $("input[name='{$field.name}']").val(sortVal.join(','));
                }
            })
        </script>
        {/empty}
        {/case}
        {case value="hasTags"}
        {present name="field['value']"}
        {volist name="field['value']" id='vo2'}
        <span style="margin-left: 1px; margin-top: 1px;" data-value="{$vo2}" class="">
		<i class="fa fa-tag"></i> {$vo2}&nbsp;&nbsp;</span>
        <input type="hidden" name="{$field.name}" value="{$vo2}">
        {/volist}
        {/present}
        {/case}
        {case value="tags"}
        <input type="text" size="50" id='tags_{$field.name}'  data-tagname='{$field.name}[]' data-toggle="tags" data-url="{:\\think\\facade\\Url::build('Tags/ajaxLists')}"  placeholder="输入关键字，回车提交">
        {present name='field.value'}
        已有标签：
        <div class='bjui-tags' style="border: 0px solid;background: ;    background-color:; ">
            {volist name='field.value' id='vo2'}
            <span class="label label-tag" id='has_tag_{$key}' data-value="{$vo2}" style="margin-left: 1px; margin-top: 1px;color: #6FB4F5;">
		<i class="fa fa-tag"></i>{$vo2}&nbsp;&nbsp;
		<a href="#" class="close" style='' onclick="removeTag({$key})">×</a>
		</span>
            <input type="hidden" id='has_tag_hide_{$key}' name="{$field.name}[]" value="{$vo2}">
            {/volist}
        </div>
        {/present}
        <script type="text/javascript">
            function removeTag(id){
                $('#has_tag_'+id).remove();
                $('#has_tag_hide_'+id).remove();
            }
            /*  $(document).ready(function(){
                  $("#tags_{$field.name}").append("<span class='label label-tag' data-value='China' style='margin-left: 1px; margin-top: 1px;'><i class='fa fa-tag'></i> 中国&nbsp;&nbsp;<a href='#' class='close'>×</a></span>");
                          $("#tags_{$field.name}").after("这是新增的内容");
                          $(".bjui-tags").after("这是新增的内容1");
                      });*/
        </script>

        {/case}

        {case value="image"}
        {php}
            $images = [];
            if(is_numeric($field['value']) && $field['value']>0){
            $images[] = \app\file\model\Picture::find($field['value']);
            }elseif(is_object($field['value'])){
            $images[] = $field['value'];
            }elseif(is_array($field['value'])){
            $images = $field['value'];
            }else{
            $images = [];
            }
            if($field['options']['limit'] <= count($images))
            {
            $replace = 1;
            }else{
            $replace = 0;
            }
        {/php}
<style>
    .layui-upload-img {
        width: 92px;
        height: 92px;
        margin: 0 10px 10px 0;
    }
</style>
<button type="button" class="layui-btn" id="test-upload-normal">上传图片</button>
<div class="layui-upload-list">
    <img class="layui-upload-img" id="test-upload-normal-img" src="/static/common/images/default_image_240.gif">
    <p id="test-upload-demoText"></p>
</div>
<script>
    layui.use(['admin', 'upload'], function(){
        var $ = layui.jquery
            ,upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test-upload-normal'
          //  ,accept: 'file' //普通文件
          //  ,exts: 'zip|rar|7z' //只允许上传压缩文件
         //   ,size: 60 //限制文件大小，单位 KB
            ,url:"{:\\think\\facade\\Url::build('file/Picture/upload')}"
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#test-upload-normal-img').attr('src', result); //图片链接（base64）
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#test-upload-demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });

        //多图片上传
        upload.render({
            elem: '#test-upload-more'
            ,url: '{:\\think\\facade\\Url::build(\'file/Picture/upload\')}'
            ,multiple: true
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#test-upload-more-list').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                });
            }
            ,done: function(res){
                //上传完毕
            }
        });




    });
</script>
        <div class="row" style="display: none">

            <div class="col-md-12">
                <div id="uploader_{$field.name}" class="wu-example" data-replace="{$replace}" data-file-count="{$images|count}" data-file-size="0" data-state="pedding" data-limit="{$field.options.limit}">
                    <div class="queueList filled">
                        <ul class="filelist" id="filePicker_{$field.name}_lists">
                            <li class="default-image"  {notempty name='images' } style="display: none" {/notempty}>
                            <p class="title">默认</p>
                            <p class="imgWrap"><img src="/static/common/images/default_image_240.gif"></p>
                            </li>
                            {notempty name='images' }
                            {volist name='images' id='vo'}
                            <li class="state-complete upload_ok_{$vo.id}" onmouseover="mouseOver(this)" onmouseout="mouseOut(this)">
                                <p class="title news">{$vo.name}</p>
                                <p class="imgWrap"><img src="{$vo.url_normal}"></p>
                                <p class="progress"><span></span></p>
                                <div class="file-panel" style="height: 30px;display:none; overflow: hidden;"  onclick="deleteObj(this,{$field.options.limit})">
                                    <span class="cancel">删除</span>
                                </div>
                                <span class="success"></span>
                                <input type="hidden" class="name_{$field.name}"  name="{eq name='field.options.limit' value = '1'}{$field.name}{else/}{$field.name}[]{/eq}" value="{$vo['id']}">
                            </li>
                            {/volist}
                            {/notempty}
                        </ul>
                    </div>
                    <div class="statusBar" style="">
                        <div class="progress" style="display: none;">
                            <span class="text">0%</span>
                            <span class="percentage" style="width: 0%;"></span>
                        </div>
                        <div class="info filePicker_info" >{eq name='replace' value='1'}新添加图片则替换旧图片{else/}{$field.options.remark|default=''}{/eq}</div>
                        <div class="btns">
                            <div id="filePicker_{$field.name}" class="webuploader-container filePicker_button">
                                添加图片
                            </div>
                            <div class="uploadBtn filePicker_upload" >{eq name='replace' value='1'} 修改图片{else/}开始上传{/eq}</div>
                        </div>
                    </div>
                </div>
            </div>

            <script type="text/javascript">
                // 可能有pedding, ready, uploading, confirm, done.$("#uploader_{$field.name}").data('file-size');
                // 初始化Web Uploader
                var uploader_{$field.name} = WebUploader.create({
                    // 选完文件后，是否自动上传。
                    auto: true,
                    fileNumLimit: 0,//$("#uploader_{$field.name}").data('limit'),
                    // swf文件路径
                    swf: '/static/b-jui/plugins/webuploader/Uploader.swf',
                    // 文件接收服务端。
                    server: "{:\\think\\facade\\Url::build('file/Picture/upload')}",
                    // 选择文件的按钮。可选。
                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                    pick: '#filePicker_{$field.name}',
                    // 文件大小限制。
                    fileSizeLimit :"{$field.options.max_size}",
                    compress:false,
                    // 只允许选择图片文件。
                    accept: {
                    title: 'Images',
                        extensions: "{$field.options.exts}",
                        mimeTypes: "{$field.options.mimes}"
                }
                });
                // 上传按钮
                $("#uploader_{$field.name}").find('.filePicker_upload').on('click', function() {
                    console.log($("#uploader_{$field.name}").data('state'));
                    if ($(this).hasClass('disabled')) {
                        return false
                    }
                    if ($("#uploader_{$field.name}").data('state') === 'ready') {
                        uploader_{$field.name}.upload()
                    } else if ($("#uploader_{$field.name}").data('state') === 'paused') {
                        uploader_{$field.name}.upload()
                    } else if ($("#uploader_{$field.name}").data('state') === 'uploading') {
                        uploader_{$field.name}.stop()
                    }else {
                        $(this).alertmsg('error', "请选择上传图片");
                    }
                })
                // 当有文件添加进来的时候
                uploader_{$field.name}.on( 'fileQueued', function( file ) {
                    var $li = $(
                        '<li class="" id="' + file.id + '" onmouseover="mouseOver(this)" onmouseout="mouseOut(this)">' +
                        '<p class="title news">' + file.name + '</p>' +
                        '<p class="imgWrap"><img src=""></p>' +
                        '<p class="progress"><span></span></p>' +
                     //   '<input type="hidden" class="name_{$field.name}"  name="{php}if(0 == $field["options"]["limit"]){echo $field["name"];}else{echo $field["name"]."[]";};{/php}" value="0">'+
                        '<div class="file-panel" style="height: 30px; display:none;overflow: hidden;"  onclick=\'deleteObj(this,$("#uploader_{$field.name}").data("limit"))\'><span class="cancel">删除</span></div>' +
                        '</li>'
                        ),
                        $img = $li.find('img');
                    if (!$("#uploader_{$field.name}").data('file-count'))
                    {
                        $("#uploader_{$field.name}").find('.default-image').hide();
                    }
                    //$("#fileList").append( $li );
                    $("#filePicker_{$field.name}_lists").append( $li );
                    if($("#uploader_{$field.name}").data('replace')){
                        console.log($("#uploader_{$field.name}").find('.default-image').siblings().eq(0).remove());
                        $("#uploader_{$field.name}").data('file-count',$("#uploader_{$field.name}").data('file-count')-1);
                    }
                    $("#uploader_{$field.name}").data('file-count',$("#uploader_{$field.name}").data('file-count')+1);
                    $("#uploader_{$field.name}").data('file-size',$("#uploader_{$field.name}").data('file-size') + file.size);
                    // 创建缩略图
                    // 如果为非图片文件，可以不用调用此方法。
                    // thumbnailWidth x thumbnailHeight 为 100 x 100
                    uploader_{$field.name}.makeThumb( file, function( error, src ) {
                        if ( error ) {
                            $img.replaceWith('<span>不能预览</span>');
                            return;
                        }
                        $img.attr( 'src', src );
                    }, 100, 100 );
                    $("#uploader_{$field.name}").data('state','ready');
                    if($('#filePicker_{$field.name}_lists').children().length>=$("#uploader_{$field.name}").data("limit")){
                        $("#uploader_{$field.name}").data('replace',1);
                        $("#uploader_{$field.name}").find('.filePicker_info').html('达到上限，新添加图片则替换旧图片');
                    }
                });
                // 文件上传过程中创建进度条实时显示。
                uploader_{$field.name}.on( 'uploadProgress', function( file, percentage ) {
                    var $li = $( '#'+file.id ),
                          $percent = $li.find('.progress span');
                      // 避免重复创建
                      if ( !$percent.length ) {
                          $percent = $('<p class="progress"><span></span></p>')
                                  .appendTo( $li )
                                  .find('span');
                      }
                      $percent.css( 'width', percentage * 100 + '%' );
                    $("#filePicker_{$field.name}").parent().prev().prev().show();
                    $("#uploader_{$field.name}").find('.filePicker_info').hide();
                    $("#uploader_{$field.name}").data('state','uploading');
                    $("#uploader_{$field.name}").find('.filePicker_upload').addClass('state-uploading');
                    $("#uploader_{$field.name}").find('.filePicker_upload').text('暂停上传')
                });

                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                uploader_{$field.name}.on( 'uploadSuccess', function( file ,result) {
                    $( '#'+file.id ).addClass('upload-state-done');
                    console.log(result);
                    if(0 == result.code){
                        // 上传成功
                        var html = '<input type="hidden" class="name_{$field.name}"  name="{eq name="field.options.limit" value = "1"}{$field.name}{else/}{$field.name}[]{/eq}" value="'+result.data.id+'">';
                        html += '<span class="success"></span>';
                        $('#'+file.id).append(html);
                    }else{
                    }
                    $("#uploader_{$field.name}").data('state','done');
                });

                // 文件上传失败，显示上传出错。
                uploader_{$field.name}.on( 'uploadError', function( file ) {
                    var $li = $( '#'+file.id ),
                        $error = $li.find('div.error');
                    // 避免重复创建
                    if ( !$error.length ) {
                        $error = $('<div class="error"></div>').appendTo( $li );
                    }
                    $error.text('上传失败');
                });

                // 完成上传完了，成功或者失败，先隐藏进度条。
                uploader_{$field.name}.on( 'uploadComplete', function( file ) {
                    $( '#'+file.id ).find('.progress').hide();
                    var text = '', stats;
                    if ($("#uploader_{$field.name}").data('state') === 'ready') {
                        text = '选中'+ $("#uploader_{$field.name}").data('file-count') +'张图片，共'+ WebUploader.formatSize($("#uploader_{$field.name}").data('file-size')) +'。';
                    } else if ($("#uploader_{$field.name}").data('state') === 'confirm') {
                        stats = uploader_{$field.name}.getStats()
                        if (stats.uploadFailNum) {
                            text = '已成功上传'+ stats.successNum + '张图片，'+
                                stats.uploadFailNum  +'张图片上传失败，<a class="retry" href="#">重新上传</a> 或 <a class="ignore" href="#">忽略</a>'
                        }
                    } else if ($("#uploader_{$field.name}").data('state') === 'uploaded') {
                        text = '已上传'+ $("#uploader_{$field.name}").data('file-count') + '张图片';
                    } else {
                        stats = uploader_{$field.name}.getStats();
                        text = '共'+ $("#uploader_{$field.name}").data('file-count') +'张图片（' + WebUploader.formatSize($("#uploader_{$field.name}").data('file-size')) +'），已上传' + stats.successNum + '张图片'
                        if (stats.uploadFailNum) {
                            text += '，失败' + stats.uploadFailNum;
                        }
                        $("#filePicker_{$field.name}").parent().prev().prev().hide();
                        $("#uploader_{$field.name}").find('.filePicker_info').show();
                    }
                    $("#uploader_{$field.name}").find('.filePicker_info').html(text);
                    $("#uploader_{$field.name}").find('.filePicker_upload').removeClass('state-uploading');
                    $("#uploader_{$field.name}").find('.filePicker_upload').text('开始上传');
                });
                function mouseOver(obj)
                {
                    $(obj).find('.file-panel').show();
                }
                function mouseOut(obj)
                {
                    $(obj).find('.file-panel').hide();
                }
                function deleteObj(obj,limit)
                {
                    if ($(obj).parent().siblings().length == 1)
                    {
                        $(obj).parent().parent().children(":first").show();
                    }
                    if($(obj).parent().parent().children("li").length < limit){
                        $(obj).parent().parent().parent().parent().find('.webuploader-container').show();
                    }
                    $(obj).parent().remove();
                }
            </script>

            <!-- <div class="col-md-5">
                <div class="thumbnail">
                    <input type="hidden" id='singel_image_{$field.name}' name="{$field.name}" value="">
                    <img id='singel_image_{$field.name}_img' data-src="holder.js/300x300"alt="..."
                         src="{$single_image|default=\\think\\facade\\Config::get('default.image_240')}">
                    <div class="caption">
                        <p>
                            <a href="{:\\think\\facade\\Url::build('admin/Picture/upload',['file_limit'=>1,'callback'=>'singel_image_'.$field['name']])}"
                                class="btn btn-primary" role="button"data-toggle="dialog" data-mask = 'true' data-width = '1200' data-height = '800'
                                data-id="singel_image_{$field.name}_dialog">{$field['value']? '替换图片': '上传图片'}</a>
                        </p>
                    </div>
                </div>
            </div> -->
        </div>

        {/case}
        {case value="attachment"}

        {php}
        if(is_numeric($field['value']) && $field['value']>0){
        $attachment = \app\file\model\Attachment::get($field['value']);
        }else{
        $attachment = [];
        }
        {/php}
        <div class="row">
            <div class="col-md-3">
                <div id="picker{$field.name}">选择文件</div>
                <span id="picker{$field.name}_progress"  style="display: none"class="glyphicon glyphicon-upload" aria-hidden="true"></span>

            </div>
        <div class="col-md-9">
            <div id='show_{$field.name}_dialog' {empty name='attachment'}style="display: none;"{/empty}	>
                <span class="glyphicon glyphicon-file" aria-hidden="true"></span><span id='show_{$field.name}_dialog_name'>{$attachment['name']|default=''}</span>
                <br>
                文件大小：<span id='singel_file_{$field.name}_size'>{$attachment['size_info']|default=''}</span>
                <input type="hidden"  id='singel_file_{$field.name}'   name="{$field.name}" value="{$field['value']}">
            </div>
            <script type="text/javascript">
                $(document).ready(function(){
                //http://fex.baidu.com/webuploader/doc/index.html 参考地址
                var uploader_a_{$field.name} = WebUploader.create({
                    // 选完文件后，是否自动上传。
                    auto: true,
                    chunked: true,
                    threads: 1,
                    chunkSize : 1024*1024*2,
                    // swf文件路径
                    swf: '/static/b-jui/plugins/webuploader/Uploader.swf',
                    // 文件接收服务端。
                    server: "{:\\think\\facade\\Url::build('file/Attachment/upload')}",
                    // 选择文件的按钮。可选。
                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                    pick: '#picker{$field.name}',
                    fileSizeLimit :1024*1024*{$field.options.size},
                    compress:false,
                    // 文件限制类型。
                    accept: {
                    title: '文件',
                        extensions: '{$field.options.extensions}'//,
                    // mimeTypes: '{:\\think\\facade\\Config::get('upload_attachment.mimes')}'
                },
                fileVal:'attachment',
                });
                //文件上传成功
                uploader_a_{$field.name}.on('uploadSuccess', function(file,ret){
                    if(0 == ret.code){
                        // 上传成功
                        $("#show_{$field.name}_dialog_name").html(ret.data.name);
                        if(ret.data.duration){
                            $("#singel_file_{$field.name}_size").html(ret.data.size+'，约'+(ret.data.duration/60).toFixed(1)+'分钟');
                        }else{
                            $("#singel_file_{$field.name}_size").html(ret.data.size);
                        }
                        $("#show_{$field.name}_dialog").show();
                        $("#singel_file_{$field.name}").val(ret.data.id);
                    }else{
                        // 上传错误或失败
                        $(this).alertmsg('error', ret.message);
                    }
                });
                uploader_a_{$field.name}.on('uploadProgress', function(file,percentage){
                    $("#picker{$field.name}_progress").show().html('上传进度'+(percentage * 100).toFixed(1) + '%');
                    if(1 == percentage)
                    {
                        $("#picker{$field.name}_progress").hide();
                    }
                });
                // 文件上传出错。
                uploader_a_{$field.name}.on( 'error', function( type  ) {
                    if(type == 'Q_EXCEED_SIZE_LIMIT'){
                        $(this).alertmsg('error', '文件大小超过限制');
                    }
                    if(type == 'Q_TYPE_DENIED'){
                        $(this).alertmsg('error', '不符合的文件类型');
                    }
                });
                // 文件上传失败，显示上传出错。
                /*uploader.on( 'uploadError', function( file ) {

                    $(this).alertmsg('error', '');
                });*/

                });
            </script>

        </div>
        <div class="col-md-3" style='display: none'>

            <a href="{:\\think\\facade\\Url::build('admin/Attachment/upload',['file_limit'=>1,'callback'=>'singel_file_'.{$field.name}])}" style="margin: auto;"
               class="btn btn-primary btn-lg" role="button"data-toggle="dialog" data-mask = 'true' data-width = '1200' data-height = '800'
               data-id="singel_file_{$field.name}_dialog" data-icon = 'copy'>附件列表</a>

            <!-- 文件大小<code>0</code>b -->
            <script type="text/javascript">
                function singel_file_{$field.name}(obj)
                {
                    var flag = false;
                    $("input[name='upload_ids']").each(function(){
                        var id = $(this).val();
                        $.ajax({
                            type:"GET",
                            url:"{:\\think\\facade\\Url::build('admin/Attachment/getInfo')}",
                            data:{id:id},
                            //返回数据的格式
                            datatype: "json",
                            //成功返回之后调用的函数
                            success:function(data){
                                if(0==data.code){
                                    $("#singel_file_{$field.name}_name").val(data.info.name);
                                    $("#singel_file_{$field.name}").val(data.info.id);
                                    $("#singel_file_{$field.name}_size").html(data.info.size);
                                }else{
                                    $(this).alertmsg('error', data.error);
                                }
                            },
                            //调用出错执行的函数
                            error: function(){
                                //请求出错处理
                                $(this).alertmsg('error', "{:\\think\\facade\\Lang::get('error ajax http request')}")
                            }
                        });

                        flag = true;
                    })
                    if(flag){
                        $(this).dialog('close','singel_file_{$field.name}_dialog');
                    }else{
                        $(this).alertmsg('error','您未选择需要操作的文件');
                    }
                }
            </script>
        </div>
        </div>
        {/case}
        {case value='showImg'}
        <span class="pic-box">
	<a href="{$field['value']}" download="{$field['value']}">
<img border="0" src="{$field['value']}" style="height: 260px;" alt="点击下载">
</a>
	
	</span>
        {/case}
        {case value="ias"}
        <input type="text"   name="{$field['name'][0]}" value="{$field['value'][0]|htmlspecialchars}" size="{$field['config'][0]['size']}">
        <select name="{$field['name'][1]}"  data-toggle="selectpicker"  data-width="{$field['config'][1]['width']}">
            {php}foreach($field['config'][1]['options'] as $key_opt =>$option){{/php}
            {php}
            $selected = $field['value'][1]==$key_opt ? 'selected' : '';
            {/php}
            <option value="{$key_opt}"{$selected}>{$option|htmlspecialchars}</option>
            {php}}{/php}
        </select>
        {/case}
        {default/}
        <span style="color: #f00;">错误：未知字段类型 {$field.type}</span>
        <input type="hidden" name="{$field.name}" value="{$field.value|htmlspecialchars}"/>
        {/switch}

</div>
    {notempty name='field.tips'}
   <div class="layui-form-mid layui-word-aux">
       （{$field.tips|raw}）
    </div>
    {/notempty}

</div>
{/neq}
					